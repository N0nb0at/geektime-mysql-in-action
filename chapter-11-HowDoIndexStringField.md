---
title: MySQL-11-怎么给字符串字段加索引？
date: 2019/04/29 18:53:52
categories:
  - [MySQL-in-Action]
tags:
  - [geektime]
  - [MySQL]
---

使用前缀索引，定义好长度，就可以做到既节省空间，又不用额外增加太多的查询成本。

当要给字符串创建前缀索引时，有什么方法能够确定应该使用多长的前缀呢？

在建立索引时关注的是区分度，区分度越高越好。因为区分度越高，意味着重复的键值越少。因此，可以通过统计所以上有多少个不同的值来判断要使用多长的前缀。

<!-- more -->

## 前缀索引对覆盖索引的影响

- 前缀索引可能会增加扫描行数，这会影响性能
- 使用前缀索引就无法应用覆盖索引对查询性能的优化

## 其他方式

假设维护一个公民信息系统，如果使用身份证号做长度为 6 的前缀索引，区分度会非常低。为了增加区分度，可能会需要建立长度为 12 以上的前缀索引，才能够满足需求。但是索引选取的越长，占用磁盘空间就越大，相同的数据也能放下的索引值就越少，搜索的效率也就会越低。

其他的处理方法：

- 使用倒序存储：由于身份证号码的最后 6 为没有地址码这样的重复逻辑，提供了足够的区分度。
- 使用 hash 字段：可以在表上再创建一个整数字段，用来保存身份证的校验码，同时在这个字段上创建索引。

它们的区别主要体现在以下三个方面：

1. 占用空间：倒叙存储方式在主键索引上，不会消耗额外的存储空间；而 hash 字段方法需要增加一个字段。当然，倒叙存储方式使用 4 个字节的前缀长度应该是不够的，如果再唱一点，这个消耗跟额外的 hash 字段差不多抵消了。
2. CPU 消耗：倒叙方式每次写和读的时候，都需要额外调用一次 reverse 函数；而 hash 字段的方式需要在二外调用一次 crc32 函数。如果只从这两个函数的计算复杂度来看，reverse 函数额外消耗的 CPU 资源会更小一些。
3. 查询效率：使用 hash 字段方式的查询性能相对更稳定一些。因为 crc32 算出来的值虽然有冲突的概率，但是非常小，可以认为每次查询的平均扫描行数接近 1。而倒叙存储方式还是使用的前缀索引，也就是说还是会增加扫描行数。


